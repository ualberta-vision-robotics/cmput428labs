---
layout: page
title: Lab 1.2 - Tracking
description:
permalink: /tracking
img: 
importance: 2
category: Motion Estimation and Tracking
related_publications: false
---

<div class="row justify-content-md-center">
    <div class="col-sm-3 mt-4 mt-md-0">
        {% include figure.liquid loading="eager" path="assets/img/tracker.gif" title="optical flow" class="img-fluid rounded z-depth-1" %}
    </div>
</div>
<div class="caption">
    To change: filler image of tracking a banana.
</div>

## Overview

In this lab you'll implement the Lucas-Kanade tracking algorith. The goal of this algorithm is to minimize the sume of squared error between two regions, the template $$T(\mathbf{x})$$, and the warped image $$I(\mathbf{W}(\mathbf{x} ; \mathbf{p}))$$:

\begin{equation}
\sum_{\mathbf{x}}[I(\mathbf{W}(\mathbf{x} ; \mathbf{p}))-T(\mathbf{x})]^2 .
\end{equation}

$$\mathbf{p}$$ is the vector of parameters that defines our warp. It can be a simple 2-dof translation update, or it can be higher order warps such as an affine warp.

By first defining the template, we then aim to find the warped region in the next frame that best matches our template. We can then set the warped region as the new template and repeat on the next frame.

This [zip file]({{"/assets/labs/sample_videos.zip" | relative_url}}){:target="_blank"} contains the sample videos you can use to complete this lab. However, you are encouraged to capture your own.

__Important: You can obtain 2 bonus marks for each section you finish and demo while present during the lab period we introduce the lab.__

---

## 1. 2-Dof SSD Tracker (50)

Create a function `simple_tracker(img0, img1, roi, max_iterations, threshold)` takes a pair of sequenced images and a tracking region and returns the coordinates of the updated tracking region.

### a) Apply your tracker to a pair of images.
- Display the first image and define a bounding box to track using `cv2.selectROI()`. This defines the `roi` for your function.
- For the next frame, solve for $$\mathbf{u}=[u,v]^T$$ on the tracked region like in optical flow. Your tracked region is the patch.
  - Use $$\mathbf{u}$$ to update the tracked region.
    - Repeatedly solve for $$\mathbf{u}$$ and update the tracking region until `norm($$u_k$$)/norm($$u_{k-1}$$) < threshold` or `k < max_iterations`, where `k` is the number of iterations (you can define your own end condition, this is just what we suggest).
  - Your function should return the new `roi`. Update and display the this bounding box as the new tracked region (see `cv2.rectangle` for plotting).

**Deliverables:**
- Display the pair of images in your report.

**Report Question 1a:** Name one type of image processing that may improve the performance of your tracker.

### b) Create a live implementation of your tracker.

**Report Question 1b:** In what cases does the tracker perform well? In what cases does the tracker perform poorly?

### c) Apply your tracker to a video sequence that you recorded.

**Deliverables:**
- Save your video with the overlaid tracking region for your submission. Ensure the video is less than 10 mb.

**Report Question 1c:** Name one advantage and one disadvantage of using higher order warps for our tracker.

---
__Important__: Choose __one of the following three questions__ to complete for this lab to obtain the remaining 50 marks.__

<strong><font color='DarkViolet'>Grad students: choose two of the following three questions to obtain the remaining 50 marks.</font></strong>

---

## 2. Pyramidal 2-Dof SSD Tracker
Create a function `pyramidal_tracker(img0, img1, roi, levels=4, scale=2)` that performs 2-Dof SSD tracking with pyramidal guassian downsampling. You may call `simple_tracker()` within this function if you wish.

- The gaussian pyramid has `levels` layers, with each layer having a `scale` factor resolution of the layer above.
- See `cv2.pyrDown()` for gaussian downsampling.
- For each frame start with the top of the pyramid (coarsest) and solve for the new region. Propogate the result to the more detailed layer below and repeat for all layers.
  - Ensure the coordinates of the updated region match the scale factor of the layer below (i.e. multiply the translation by `scale`)
- Update the tracked region with the bounding box of the bottom layer (the layer with no downsampling) and repeat for all frames.

### Apply your pyramidal tracker to a video that you recorded.

**Deliverables:**
- Save this video to include with your submission. Ensure it is less than 10 mb.

**Report Question 2:** What are two benefits of implementing pyramidal downsampling to our tracker.

---

## 3. High-Dof Tracker
Create a function `highdof_tracker(img0, img1, roi, max_iterations, threshold)` that warps the bounding box using 4 (x, y, rotation, scale) or 6 (affine) parameters $$\mathbf{p}$$.

- See [OpenCV documentation on transformations](https://docs.opencv.org/4.x/da/d6e/tutorial_py_geometric_transformations.html).
- See [Baker and Matthews Paper on Lukas-Kanade](https://www.ncorr.com/download/publications/bakerunify.pdf)
- See [page 27 of these slides](https://ugweb.cs.ualberta.ca/~vis/courses/CompVis/lectures24/lec05bRegTrack2.pdf)

### a) Apply your tracker to a video with object motion.

**Deliverables:**
- Save the video to include in your submission. Ensure it is less than 10 mb.

**Report Question 1a:** lorem ipsum?


### b) Apply your tracker to a video with camera motion.

**Deliverables:**
- Save the video to include in your submission. Ensure it is less than 10 mb.

**Report Question 1a:** lorem ipsum?

---

## 4. Learning-based tracker

lorem ipsum

### a) lorem ipsum
- lorem ipsum

**Deliverables:**
- lorem ipsum

**Report Question 1a:** lorem ipsum?

---

## Submission Details

- Include accompanying code used to complete each question. Ensure they are adequately commented.
- Ensure all functions are and sections are clearly labeled in your report to match the tasks and deliverables outlined in the lab.
- Organize files as follows:
  - `code/` folder containing all scripts used in the assignment.
  - `media/` folder for images, videos, and results.
- Final submission format: a single zip file named `CompVisW25_lab1.2_lastname_firstname.zip` containing the above structure.
- Your combined report for Lab 1.1 and 1.2 is due shortly after (see calendar for details). The report contains all media, results, and answers as specified in the instructions above. Ensure your answers are concise and directly address the questions.
- Total marks for this lab is __100__ for all students. Your lab assignment grade with bonus marks is capped at 110%. Report bonus marks will be applied to the report grade, also capped at 110%.


