<!DOCTYPE html> <html lang="en"> <head> <meta http-equiv="Content-Type" content="text/html; charset=UTF-8"> <meta charset="utf-8"> <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"> <meta http-equiv="X-UA-Compatible" content="IE=edge"> <title> Lab 1.1 Optical Flow | CMPUT 428 Labs </title> <meta name="author" content="Computer Vision and Robotics Research Group "> <meta name="description" content="Lab resources for CMPUT428/615."> <meta name="keywords" content="cmput428, cmput615, ualberta, computing-science academic-website"> <link rel="stylesheet" href="/cmput428labs/assets/css/bootstrap.min.css?a4b3f509e79c54a512b890d73235ef04"> <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/mdbootstrap@4.20.0/css/mdb.min.css" integrity="sha256-jpjYvU3G3N6nrrBwXJoVEYI/0zw8htfFnhT9ljN3JJw=" crossorigin="anonymous"> <link defer rel="stylesheet" href="/cmput428labs/assets/css/academicons.min.css?f0b7046b84e425c55f3463ac249818f5"> <link defer rel="stylesheet" href="/cmput428labs/assets/css/scholar-icons.css?62b2ac103a88034e6882a5be5f3e2772"> <link defer rel="stylesheet" type="text/css" href="https://fonts.googleapis.com/css?family=Roboto:300,400,500,700|Roboto+Slab:100,300,400,500,700|Material+Icons&amp;display=swap"> <link defer rel="stylesheet" href="/cmput428labs/assets/css/jekyll-pygments-themes-github.css?591dab5a4e56573bf4ef7fd332894c99" media="" id="highlight_theme_light"> <link rel="shortcut icon" href="/cmput428labs/assets/img/favi.ico?824de67f88398f637ce988037dfe4447"> <link rel="stylesheet" href="/cmput428labs/assets/css/main.css?d41d8cd98f00b204e9800998ecf8427e"> <link rel="canonical" href="https://ualberta-vision-robotics.github.io/cmput428labs/labs/opticalflow"> <script src="/cmput428labs/assets/js/theme.js?9a0c749ec5240d9cda97bc72359a72c0"></script> <link defer rel="stylesheet" href="/cmput428labs/assets/css/jekyll-pygments-themes-native.css?5847e5ed4a4568527aa6cfab446049ca" media="none" id="highlight_theme_dark"> <script>
    initTheme();
  </script> </head> <body class="fixed-top-nav sticky-bottom-footer"> <header> <nav id="navbar" class="navbar navbar-light navbar-expand-sm fixed-top" role="navigation"> <div class="container"> <a class="navbar-brand title font-weight-lighter" href="/cmput428labs/"> CMPUT 428 Labs </a> <button class="navbar-toggler collapsed ml-auto" type="button" data-toggle="collapse" data-target="#navbarNav" aria-controls="navbarNav" aria-expanded="false" aria-label="Toggle navigation"> <span class="sr-only">Toggle navigation</span> <span class="icon-bar top-bar"></span> <span class="icon-bar middle-bar"></span> <span class="icon-bar bottom-bar"></span> </button> <div class="collapse navbar-collapse text-right" id="navbarNav"> <ul class="navbar-nav ml-auto flex-nowrap"> <li class="nav-item "> <a class="nav-link" href="/cmput428labs/">Home </a> </li> <li class="nav-item active"> <a class="nav-link" href="/cmput428labs/labs/">Labs <span class="sr-only">(current)</span> </a> </li> <li class="toggle-container"> <button id="light-toggle" title="Change theme"> <i class="ti ti-sun-moon" id="light-toggle-system"></i> <i class="ti ti-moon-filled" id="light-toggle-dark"></i> <i class="ti ti-sun-filled" id="light-toggle-light"></i> </button> </li> </ul> </div> </div> </nav> <progress id="progress" value="0"> <div class="progress-container"> <span class="progress-bar"></span> </div> </progress> </header> <div class="container mt-5" role="main"> <div class="post"> <header class="post-header"> <h1 class="post-title">Lab 1.1 Optical Flow</h1> <p class="post-description"></p> </header> <article> <div class="row justify-content-md-center"> <div class="col-sm-3 mt-4 mt-md-0"> <figure> <picture> <source class="responsive-img-srcset" srcset="/cmput428labs/assets/img/opticalflow-480.webp 480w,/cmput428labs/assets/img/opticalflow-800.webp 800w,/cmput428labs/assets/img/opticalflow-1400.webp 1400w," type="image/webp" sizes="95vw"></source> <img src="/cmput428labs/assets/img/opticalflow.gif" class="img-fluid rounded z-depth-1" width="100%" height="auto" title="optical flow" loading="eager" onerror="this.onerror=null; $('.responsive-img-srcset').remove();"> </picture> </figure> </div> </div> <div class="caption"> 2 DOF optical flow on a soccer ball. </div> <p>In this lab, you’ll implement a basic 2-DoF optical flow algorithm. These flow vectors describe the motion in a scene. Equation 1 is the basis of optical flow. We can capture the temporal shift between two frames by using a first order approximation:</p> <p>\begin{equation} -I_t=\nabla I^T\mathbf{u} \end{equation}</p> <p>where \(I_t\) is the temporal image gradient, and \(I_x\) and \(I_y\) are the spatial image gradients. For each image in our sequence, we want to find its temporal and spatial gradients and solve for \(\mathbf{u}\).</p> <p>This <a href="/cmput428labs/assets/labs/bus.zip" target="_blank">zip file</a> contains the resources needed to complete this lab.</p> <h4>0. Capturing images with OpenCV</h4> <p>The following code grabs frames from a camera and displays them in a new window.</p> <div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kn">import</span> <span class="n">cv2</span>
<span class="n">cam</span> <span class="o">=</span> <span class="n">cv2</span><span class="p">.</span><span class="nc">VideoCapture</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">cv2</span><span class="p">.</span><span class="n">CAP_FIREWIRE</span><span class="p">)</span> <span class="c1">#Remove second arg if using webcam
</span><span class="k">while</span> <span class="bp">True</span><span class="p">:</span>
    <span class="n">ret_val</span><span class="p">,</span> <span class="n">img</span> <span class="o">=</span> <span class="n">cam</span><span class="p">.</span><span class="nf">read</span><span class="p">()</span>
    <span class="n">cv2</span><span class="p">.</span><span class="nf">imshow</span><span class="p">(</span><span class="sh">'</span><span class="s">test</span><span class="sh">'</span><span class="p">,</span> <span class="n">img</span><span class="p">)</span>
</code></pre></div></div> <p>Modify this code to use imwrite to save a sequence of images we will use for this lab.</p> <h4>1. Single Window Optical Flow (20) - complete the following steps for one timestep</h4> <p>a) Temporal Image Gradient <br> Convert a sequenced pair of images to grayscale. Find the temporal difference between the two images. Threshold the temporal derivative by setting values that do not meet our threshold to zero. Test different threshold values until motion is isolated and noise is minimized. <br> <strong>Display the final thresholded temporal derivative in your report.</strong> <br> <strong>Report question 1a: What does the temporal image gradient tell us about our image pair?</strong> <br></p> <p>b) Spatial Image Gradient <br> Find the spatial image gradients \(I_x\) and \(I_y\) (see numpy.gradient) along the first and zero-th axes of our image, respectively. <br> <strong>Display these results in your report.</strong> <br> <strong>Report question 1b: What edges are prominent in each spacial gradient?</strong> <br></p> <p>c) Solve for \(\mathbf{u}=[u,v]^T\). Plot \(\mathbf{u}\) onto the center of our image using matplotlib.pyplot.quiver. <br> <strong>Display these results in your report.</strong> <br> <br></p> <h4>2. Single Window Optical Flow Video (20)</h4> <p>a) Repeat the single window optical flow steps on this video. <br> <strong>Save these results to include in your submission</strong> <br> <strong>Report question 2a: What is one limitation of finding a single optical flow vector on the entire window?</strong> <br> <br></p> <h4>3. Optical Flow on Patches (20) - complete the following steps for one timestep</h4> <p>a) Divide our gradients into patches of size block_size x block_size. Ensure you choose a block_size divisible into our image dimensions (8, 16, 32 etc.). Using numpy.meshgrid may help you find the borders of each tile. <br> <strong>Report question 3a: How does changing block_size affect our results? What is one benefit and drawback of increasing block_size?</strong> <br></p> <p>b) Find flow vectors for each tile. Store each \(u\) and \(v\) into their own respective 2D array (these will be the U and V arguments for quiver). <br> <strong>Report question 3b: What are the dimensions of our U and V arrays that store each motion vector (Give answer w.r.t. image dimensions and block_size)?</strong> <br></p> <p>c) Plotting <br> For each tile, plot the motion vector \(\mathbf{u}\) onto the centre of the tile using matplotlib.pyplot.quiver. <br> <strong>Display these results in your report.</strong> <br> <br></p> <h4>4. Optical flow video (20) </h4> <p>a) With our provided image sequence, apply our optical flow algorithm. <br> <strong>Save these results to include in your submission.</strong> <br></p> <p>b) Repeat with a recording of your own. <br> <strong>Save these results to include in your submission.</strong> <br></p> <p>c) Implement a live instance of optical flow using cam.read(). <br> <strong>Report question 4: What sort of motion have we captured here? Name two types of motion we cannot account for with our current method.</strong> <br> <br></p> <h4>5. Rotation and Scale (20)</h4> <p>a) Find rotation and scale gradients (\(I_r\) and \(I_s\)) for a single image. <br> <strong>Display these results in your report</strong> <br></p> <p>b) Solve motion vectors \(r\) and \(s\) using a formulation similar to Equation 1 in a single window (i.e. no tiles) of a video that has rotation and zoom along with respect to camera axis. Plot your results by mapping the x-vector to rotation and the y-vector to scale. <br> <strong>Save these results to include in your submission</strong> <br></p> <p><br></p> <font color="green">Grad students: Celebrate! There is no additional work for you this week.</font> <p><br> <br></p> <h4>Submission Details</h4> <p><br> <br></p> </article> </div> </div> <footer class="sticky-bottom mt-5" role="contentinfo"> <div class="container"> © Copyright 2025 Computer Vision and Robotics Research Group. Created by Allie Luo and Justin Valentine. Powered by <a href="https://jekyllrb.com/" target="_blank" rel="external nofollow noopener">Jekyll</a> with <a href="https://github.com/alshedivat/al-folio" rel="external nofollow noopener" target="_blank">al-folio</a>. </div> </footer> <script src="https://cdn.jsdelivr.net/npm/jquery@3.6.0/dist/jquery.min.js" integrity="sha256-/xUj+3OJU5yExlq6GSYGSHk7tPXikynS7ogEvDej/m4=" crossorigin="anonymous"></script> <script src="/cmput428labs/assets/js/bootstrap.bundle.min.js"></script> <script src="https://cdn.jsdelivr.net/npm/mdbootstrap@4.20.0/js/mdb.min.js" integrity="sha256-NdbiivsvWt7VYCt6hYNT3h/th9vSTL4EDWeGs5SN3DA=" crossorigin="anonymous"></script> <script defer src="https://cdn.jsdelivr.net/npm/masonry-layout@4.2.2/dist/masonry.pkgd.min.js" integrity="sha256-Nn1q/fx0H7SNLZMQ5Hw5JLaTRZp0yILA/FRexe19VdI=" crossorigin="anonymous"></script> <script defer src="https://cdn.jsdelivr.net/npm/imagesloaded@5.0.0/imagesloaded.pkgd.min.js" integrity="sha256-htrLFfZJ6v5udOG+3kNLINIKh2gvoKqwEhHYfTTMICc=" crossorigin="anonymous"></script> <script defer src="/cmput428labs/assets/js/masonry.js?a0db7e5d5c70cc3252b3138b0c91dcaf" type="text/javascript"></script> <script defer src="https://cdn.jsdelivr.net/npm/medium-zoom@1.1.0/dist/medium-zoom.min.js" integrity="sha256-ZgMyDAIYDYGxbcpJcfUnYwNevG/xi9OHKaR/8GK+jWc=" crossorigin="anonymous"></script> <script defer src="/cmput428labs/assets/js/zoom.js?85ddb88934d28b74e78031fd54cf8308"></script> <script src="/cmput428labs/assets/js/no_defer.js?2781658a0a2b13ed609542042a859126"></script> <script defer src="/cmput428labs/assets/js/common.js?e0514a05c5c95ac1a93a8dfd5249b92e"></script> <script defer src="/cmput428labs/assets/js/copy_code.js?12775fdf7f95e901d7119054556e495f" type="text/javascript"></script> <script defer src="/cmput428labs/assets/js/jupyter_new_tab.js?d9f17b6adc2311cbabd747f4538bb15f"></script> <script async src="https://d1bxh8uas1mnw7.cloudfront.net/assets/embed.js"></script> <script async src="https://badge.dimensions.ai/badge.js"></script> <script defer type="text/javascript" id="MathJax-script" src="https://cdn.jsdelivr.net/npm/mathjax@3.2.2/es5/tex-mml-chtml.js" integrity="sha256-MASABpB4tYktI2Oitl4t+78w/lyA+D7b/s9GEP0JOGI=" crossorigin="anonymous"></script> <script src="/cmput428labs/assets/js/mathjax-setup.js?70d799092f862ad98c7876aa47712e20"></script> <script defer src="https://cdnjs.cloudflare.com/polyfill/v3/polyfill.min.js?features=es6" crossorigin="anonymous"></script> <script defer src="/cmput428labs/assets/js/progress-bar.js?2f30e0e6801ea8f5036fa66e1ab0a71a" type="text/javascript"></script> <script src="/cmput428labs/assets/js/vanilla-back-to-top.min.js?f40d453793ff4f64e238e420181a1d17"></script> <script>
    addBackToTop();
  </script> </body> </html>